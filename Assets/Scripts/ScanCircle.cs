using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

//Controls the targeting circle used to find anomolies
public class ScanCircle : MonoBehaviour
{

    [SerializeField] private Transform myTransform = null;

    [SerializeField] private Transform artTransform = null;

    [SerializeField] private Image progressBarFill = null;

    [SerializeField] private Animator myAnimator = null;

    [SerializeField] private float idleRotationSpeed = 10f;
    [SerializeField] private float targetingRotationSpeed = 20f;

    [SerializeField] private float destroyTime = 3f;

    private float currentDestroyTime = 0f;

    private bool targeting = false;

    private bool damaging = false;

    void Update()
    {
        UpdatePositionAndRotation();
        CheckForInput();
        CheckForDamaging();
    }

    private void CheckForDamaging()
    {
        if (damaging)
        {
            currentDestroyTime += Time.deltaTime;
            progressBarFill.fillAmount = currentDestroyTime / destroyTime;
        }
    }

    private void CheckForInput()
    {
        if (Input.GetMouseButtonDown(0) && !targeting)
        {
            myAnimator.SetTrigger("Click");
            SoundManager.Instance.PlayFailClickSound();
        }
    }

    private void UpdatePositionAndRotation()
    {
        myTransform.position = Input.mousePosition;

        if (targeting)
        {
            artTransform.Rotate(0f, 0f, targetingRotationSpeed * Time.deltaTime);
        }
        else
        {
            artTransform.Rotate(0f, 0f, idleRotationSpeed * Time.deltaTime);
        }
    }

    public void UpdateScanCircleStatus(bool _nearTarget)
    {
        if (gameObject.activeInHierarchy)
        {
            myAnimator.SetBool("Targeting", _nearTarget);
            targeting = _nearTarget;
        }
    }

    public void UpdateDamagingStatus(bool _damaging)
    {
        damaging = _damaging;
        if (!_damaging)
        {
            progressBarFill.fillAmount = 0f;
            currentDestroyTime = 0f;
        }
    }

}
